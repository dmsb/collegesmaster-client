<div class="mat-elevation-z4">
  <table mat-table [dataSource]="challenges"
    #matSortChallenges="matSort" matSort matSortActive="discipline.name" matSortDisableClear matSortDirection="desc">
    
    <!-- Actions Column -->
    <ng-container matColumnDef="actions"> 
      <th mat-header-cell *matHeaderCellDef>Actions</th>
      <td mat-cell *matCellDef="let currentChallenge">
        <a (click) = "setSelectedChallenge(currentChallenge)" class="waves-effect waves-light btn-small modal-trigger" href="#challenge_modal"><i class="material-icons center">edit</i></a>
        <a (click) = "removeChallenge(currentChallenge.id)" class="waves-effect waves-light btn-small"><i class="material-icons center">delete</i></a>
      </td>
    </ng-container>

    <!-- Discipline Column -->
    <ng-container matColumnDef="discipline.name">
      <th mat-header-cell mat-sort-header *matHeaderCellDef>Discipline</th>
      <td mat-cell *matCellDef="let currentChallenge">{{currentChallenge.discipline.name}}</td>
    </ng-container>

    <!-- Title Column -->
    <ng-container matColumnDef="title">
      <th mat-header-cell mat-sort-header *matHeaderCellDef>Title</th>
      <td mat-cell *matCellDef="let currentChallenge">{{currentChallenge.title}}</td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let currentChallenge; columns: displayedColumns;"></tr>
  </table>
  <mat-paginator #matPaginatorChallenges='matPaginator' [length]="resultsLength" [pageSize]="5"></mat-paginator>
</div>

<!-- Challenge Modal Structure -->
<div id="challenge_modal" class="modal modal-fixed-footer">
  <div class="modal-content">
    <h4><i class="material-icons prefix">description</i> Challenge</h4>
    
    <div class="row">
      <form class="col s12">
        <div class="row">
          <div class="input-field col s6">
            <input id="challenge_title" type="text" class="validate" maxlength="50"
              required [(ngModel)]="selectedChallenge.title" name="title" #title>
            <label class="active" for="challenge_title">Title</label>
          </div>
          <div class="input-field col s2">
            <select [(ngModel)]="selectedChallenge.enabled" name = 'enabled'>
              <option *ngFor="let option of enabledOptions" [value]="option.id">{{option.value}}</option>
            </select>
            <label>Enabled</label>
          </div>
          <div class="input-field col s3">
            <select [(ngModel)]="selectedChallenge.challengeType" name = 'challengeType'>
              <option *ngFor="let currentChallengeType of (challengeTypeEnum | EnumToArrayPipe)" 
              [value]="currentChallengeType.key">{{currentChallengeType.value}}</option>
            </select>
            <label>Type</label>
          </div>
        </div>
        <div class="row">
          <div class="input-field col s4">
            <input id="challenge_discipline" type="text" matInput [formControl]="myControl" [matAutocomplete]="auto">
            <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn" (optionSelected)='selectDiscipline($event.option.value)'>
              <mat-option *ngFor="let discipline of filteredDisciplines | async" [value]="discipline">
                {{discipline.name}}
              </mat-option>
            </mat-autocomplete>
            <label class="active" for="challenge_discipline">Discipline</label>
          </div>
          <div class="input-field col s3">
            <input id="challenge_creation_date" type="text" 
            [value]="selectedChallenge.creationDate | date : 'MM/dd/yyyy hh:mm:ss'" readonly>
            <label class="active" for="challenge_creation_date">Creation Date</label>
          </div>
        </div>
      </form>
    </div>

    <div class="row">
    <h5><i class="material-icons prefix">list</i> Questions</h5>
    <div class="mat-elevation-z1">
        <table mat-table [dataSource]="selectedChallenge.questions"
          #matSortQuestions='matSort' matSort matSortActive="punctuation" matSortDisableClear matSortDirection="desc">
      
          <!-- Actions Column -->
          <ng-container matColumnDef="actions"> 
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let currentQuestion">
                <a (click) = "setSelectedQuestion(currentQuestion)" class="waves-effect waves-light btn-small modal-trigger" href="#question_modal"><i class="material-icons center">edit</i></a>
                <a (click) = "removeSelectedQuestion(currentQuestion.id)" class="waves-effect waves-light btn-small"><i class="material-icons center">delete</i></a>
              </td>
            </ng-container>

          <!-- Description Column -->
          <ng-container matColumnDef="description">
            <th mat-header-cell mat-sort-header *matHeaderCellDef>Description</th>
            <td mat-cell *matCellDef="let currentQuestion">{{currentQuestion.description}}</td>
          </ng-container>
      
          <!-- Punctuation Column -->
          <ng-container matColumnDef="punctuation">
            <th mat-header-cell mat-sort-header *matHeaderCellDef>Punctuation</th>
            <td mat-cell *matCellDef="let currentQuestion">{{currentQuestion.punctuation}}</td>
          </ng-container>
      
          <tr mat-header-row *matHeaderRowDef="displayedQuestionColumns"></tr>
          <tr mat-row *matRowDef="let currentQuestion; columns: displayedQuestionColumns;"></tr>
        </table>
        <mat-paginator #matPaginatorQuestions='matPaginator' [length]="resultsQuestionLength" [pageSize]="5"></mat-paginator>
      </div>
    </div>
  </div>

  <div class="modal-footer">
      <a (click) = "closeChallengeModal()" class="waves-effect waves-light btn"><i class="material-icons center">cancel</i></a>
      <a (click) = "saveChallenge(selectedChallenge)" class="waves-effect waves-light btn"><i class="material-icons center">save</i></a>
  </div>
</div>

<!-- Question Modal Structure -->
<div id="question_modal" class="modal modal-fixed-footer">
  <div class="modal-content">
    <h4><i class="material-icons prefix">description</i> Question</h4>
    <div class="row">
      <form class="col s12">
        <div class="row">
          <div class="input-field col s10">
            <textarea id="question_description" type="text" class="materialize-textarea"
              required [(ngModel)]="selectedQuestion.description" name="description" #description></textarea>
            <label class="active" for="question_description">Description</label>
          </div>
          <div class="input-field col s2">
            <input class="validade" type="number" [(ngModel)]="selectedQuestion.punctuation" name = 'punctuation' #punctuation>
            <label>Punctuation</label>
          </div>
        </div>
      </form>
    </div>
  </div>
  <div class="modal-footer">
      <a (click) = "closeQuestionModal()" class="waves-effect waves-light btn"><i class="material-icons center">cancel</i></a>
      <a (click) = "saveChallenge(selectedChallenge)" class="waves-effect waves-light btn"><i class="material-icons center">save</i></a>
  </div>
</div>